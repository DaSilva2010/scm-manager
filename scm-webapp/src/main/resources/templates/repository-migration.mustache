<!DOCTYPE html>
<html>
<head>
  <title>SCM-Manager Migration</title>
  <link rel="stylesheet" type="text/css" href="{{ contextPath }}/styles/scm.css">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div id="root">
  <div>
    <div class="App">
      <section class="hero is-dark is-small">
        <div class="hero-body">
          <div class="container">
            <div class="columns is-vcentered">
              <div class="column"><img src="{{ contextPath }}/images/logo.png" alt="SCM-Manager"></div>
            </div>
          </div>
        </div>
      </section>
      <div class="main">
        <section class="section">
          <div class="container">
            <p class="content">
              <h1 class="title">SCM-Manager Migration</h1>
              <h2 class="subtitle">You have migrated from SCM-Manager v1 to SCM-Manager v2.</h2>
              <p>
                To migrate the existing repositories you have to specify a namespace and a name for each on them
                as well as a migration strategy.
              </p>
              <p>
                The strategies are the following:
                <table class="table">
                  {{#strategies}}
                    <tr>
                      <th>{{name}}</th>
                      <td>{{description}}</td>
                    </tr>
                  {{/strategies}}
                </table>
              </p>
            </div>
            <hr>
          {{#validationErrorsFound}}
            <div class="notification is-danger">Please correct the invalid namespaces or names below and try again.</div>
            <hr>
          {{/validationErrorsFound}}
            <form action="{{submitUrl}}" method="post">
              <table class="card-table table is-hoverable is-fullwidth">
                <tr>
                  <th>Original name</th>
                  <th>Type</th>
                  <th>New namespace
                    <span class="tooltip is-tooltip-right is-tooltip-multiline t-tooltip-0-1-38" data-tooltip="The namespace of the repository. This will be part op the url. The new namespace must consist of letters, digits, dots, dashes and underscores (it must not start with a dash or a underscore)."><i class="fa fa-question-circle has-text-info t-textinfo-0-1-10"></i></span>
                  </th>
                  <th>New name
                    <span class="tooltip is-tooltip-right is-tooltip-multiline t-tooltip-0-1-38" data-tooltip="The name of the repository. This will be part op the url. The new name must consist of letters, digits, dots, dashes and underscores (it must not start with a dash or a underscore)."><i class="fa fa-question-circle has-text-info t-textinfo-0-1-10"></i></span>
                  </th>
                  <th>Strategy
                    <span class="tooltip is-tooltip-right is-tooltip-multiline t-tooltip-0-1-38" data-tooltip="The strategy used to migrate the data directory of the repository. See above for the means of the different strategies."><i class="fa fa-question-circle has-text-info t-textinfo-0-1-10"></i></span>
                    <br>Change all:
                    <div class="field">
                      <div class="control select">
                        <select id="changeAll">
                          {{#strategies}}
                            <option>{{name}}</option>
                          {{/strategies}}
                        </select>
                      </div>
                    </div>
                  </th>
                </tr>
                {{#repositories}}
                  <tr>
                    <td>
                      {{path}}
                    </td>
                    <td>
                      {{type}}
                    </td>
                    <td>
                      <input class="input {{#namespaceInvalid}}is-danger{{/namespaceInvalid}}" type="text" name="namespace-{{id}}" value="{{namespace}}">
                    </td>
                    <td>
                      <input class="input {{#nameInvalid}}is-danger{{/nameInvalid}}" type="text" name="name-{{id}}" value="{{name}}">
                    </td>
                    <td>
                      <div class="field">
                        <div class="control select">
                          <select class="strategy-select" name="strategy-{{id}}">
                            {{#strategies}}
                              <option>{{name}}</option>
                            {{/strategies}}
                          </select>
                        </div>
                      </div>
                    </td>
                  </tr>
                {{/repositories}}
              </table>
              <button class="button is-primary" type="submit">Submit</button>
            </form>
          </div>
        </section>
      </div>
    </div>
  </div>
</body>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const changeAllSelector = document.getElementById('changeAll');
    changeAllSelector.onchange = function () {
      const strategySelects = document.getElementsByClassName('strategy-select');
      console.log("selects:", strategySelects);
      console.log("setting to:", changeAllSelector.value);
      Array.prototype.forEach.call(strategySelects, s => s.value = changeAllSelector.value);
    };
  });
</script>
</html>
